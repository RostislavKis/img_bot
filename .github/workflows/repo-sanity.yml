name: Repository Sanity Check

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  sanity:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Sanity Check)
        run: |
          set -e
          
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É img_bot —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
          echo ""
          
          error_found=0
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
          for dir in bot comfy utils workflows docs config; do
            if [ ! -d "$dir" ]; then
              echo "‚ùå –ù–ï–¢–£ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $dir/"
              error_found=1
            else
              echo "‚úÖ –ï—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $dir/"
            fi
          done
          
          echo ""
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ CHANGELOG_INTERNAL.md
          if [ ! -f "docs/CHANGELOG_INTERNAL.md" ]; then
            echo "‚ùå –ù–ï–¢–£ —Ñ–∞–π–ª–∞: docs/CHANGELOG_INTERNAL.md"
            error_found=1
          else
            echo "‚úÖ –ï—Å—Ç—å —Ñ–∞–π–ª: docs/CHANGELOG_INTERNAL.md"
          fi
          
          echo ""
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ "–ø—É—Å—Ç–æ–π" ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–¥
          code_found=0
          
          if [ -f "main.py" ]; then
            echo "‚úÖ –ù–∞–π–¥–µ–Ω main.py"
            code_found=1
          fi
          
          if find bot -type f -name "*.py" 2>/dev/null | head -1 | grep -q .; then
            echo "‚úÖ –ù–∞–π–¥–µ–Ω—ã *.py —Ñ–∞–π–ª—ã –≤ bot/"
            code_found=1
          fi
          
          if [ "$code_found" = "0" ]; then
            echo "‚ùå –ù–ï–¢–£ –∫–æ–¥–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω main.py –∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ *.py –≤ bot/"
            error_found=1
          fi
          
          echo ""
          
          # –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
          if [ "$error_found" = "1" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–ª–Ω—ã–º."
            echo "   –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–ª git add -A –ø–µ—Ä–µ–¥ push."
            echo "   –ù—É–∂–Ω—ã –≤—Å–µ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞: bot/, comfy/, utils/, workflows/, docs/, config/"
            exit 1
          else
            echo "üéâ –û–ö: –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª–Ω—ã–π."
            exit 0
          fi
