## 2026-02-08 ‚Äî T-003: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ workflows + –ø—Ä–æ–≤–µ—Ä–∫–∞ outputs

(T-003) –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è WORKFLOWS_REFERENCE.md —á–µ—Ä–µ–∑ tools/gen_workflows_reference.py (–ø–∞—Ä—Å–∏–Ω–≥ workflows/*.json).

**–¶–µ–ª—å:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ workflows –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å reference-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π outputs resolver –≤ comfy/client.py –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–¢–∏–∫–µ—Ç:** T-003

**–ò–∑–º–µ–Ω–µ–Ω–æ/–¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- docs/WORKFLOWS_REFERENCE.md (—Å–æ–∑–¥–∞–Ω, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ workflows)
- docs/CHANGELOG_INTERNAL.md (—ç—Ç–∞ –∑–∞–ø–∏—Å—å)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤ –∫–∞–∂–¥–æ–≥–æ workflow –±—É–¥–µ—Ç –¥–æ–ø–∏—Å–∞–Ω–æ –≤ WORKFLOWS_REFERENCE.md –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ JSON.

---

# CHANGELOG_INTERNAL (img_bot)

–†‚Äì–°—ì–°–Ç–†–Ö–†¬∞–†¬ª –†‚Äô–†–é–†‚Ä¢–†“ê –†–Ü–†–Ö–°—ì–°‚Äö–°–Ç–†¬µ–†–Ö–†–Ö–†—ë–°‚Ä¶ –†—ë–†¬∑–†—ò–†¬µ–†–Ö–†¬µ–†–Ö–†—ë–†‚Ññ –†—ó–°–Ç–†—ï–†¬µ–†—î–°‚Äö–†¬∞. –†‚Äô–°–É–†¬µ –†¬∑–†¬∞–†—ó–†—ë–°–É–†—ë –†–Ö–†¬∞ –°–Ç–°—ì–°–É–°–É–†—î–†—ï–†—ò.

**–†—ü–°–Ç–†¬∞–†–Ü–†—ë–†¬ª–†—ï:** –†—î–†¬∞–†¬∂–†“ë–°‚Äπ–†‚Ññ –†—î–†—ï–†—ò–†—ò–†—ë–°‚Äö –°–É –†—ë–†¬∑–†—ò–†¬µ–†–Ö–†¬µ–†–Ö–†—ë–†¬µ–†—ò –†—î–†—ï–†“ë–†¬∞ –†—õ–†‚Äò–†–á–†‚Äî–†—í–†—ú –°–É–†—ï–†“ë–†¬µ–°–Ç–†¬∂–†¬∞–°‚Äö–°–ä –†¬∑–†¬∞–†—ó–†—ë–°–É–°–ä –†¬∑–†“ë–†¬µ–°–É–°–ä.

---

## 2025-01-17 ‚Äî T-003.2: –£—Å–∏–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ outputs + CI-check –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ WORKFLOWS_REFERENCE

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ output —Ñ–∞–π–ª–∞ –∏–∑ ComfyUI, –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ workflows.

**–¢–∏–∫–µ—Ç:** T-003.2

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**

- `comfy/client.py` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ outputs
  - `_get_file_priority()` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–∞–≤–∏–ª –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
    * video (mp4/webm/mov/avi/mkv) ‚Üí 0 (TOP)
    * gif ‚Üí 1 (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    * image (png/jpg/jpeg/webp/bmp) ‚Üí 2
    * –ø—Ä–æ—á–µ–µ ‚Üí 3
  - `_extract_first_file()` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (INFO/DEBUG):
    * üì¶ Parsing outputs: —Å–∫–æ–ª—å–∫–æ –Ω–æ–¥, –∫–∞–∫–∏–µ node_ids
    * üìã Found N candidate(s): —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —Å priority, size, type
    * ‚úì Selected output: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä + reason (type=video/gif/image/other, size)
    * ‚ùå –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏: warning + available keys + –ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ JSON outputs
  - –ü—Ä–∞–≤–∏–ª–æ –≤—ã–±–æ—Ä–∞: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ (priority asc, size desc) ‚Äî –≤–∏–¥–µ–æ > gif > –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –≤–Ω—É—Ç—Ä–∏ —Ç–∏–ø–∞ –±–æ–ª—å—à–µ = –ª—É—á—à–µ

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

- `.github/workflows/docs-workflows-reference.yml` ‚Äî –Ω–æ–≤—ã–π GitHub Actions workflow
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push/PR –Ω–∞ master/main
  - –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `docs/WORKFLOWS_REFERENCE.md` —á–µ—Ä–µ–∑ `python tools/gen_workflows_reference.py`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å: `git diff --exit-code docs/WORKFLOWS_REFERENCE.md`
  - –ï—Å–ª–∏ diff –Ω–∞–π–¥–µ–Ω ‚Üí CI falls —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
  - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ workflows –≤—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å workflows/*.json

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ outputs –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ (–ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ –¥–µ–±–∞–≥–µ OOM, –ø—É—Å—Ç—ã—Ö outputs, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞)
- CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –∑–∞–±—ã–ª –æ–±–Ω–æ–≤–∏—Ç—å WORKFLOWS_REFERENCE.md –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ workflow
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω—ã: –∫–∞–Ω–¥–∏–¥–∞—Ç—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Å –ø—Ä–∏—á–∏–Ω–æ–π

---

## 2026-02-08 ‚Äî T-003: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ workflows + –ø—Ä–æ–≤–µ—Ä–∫–∞ outputs

(T-003) –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è WORKFLOWS_REFERENCE.md —á–µ—Ä–µ–∑ tools/gen_workflows_reference.py (–ø–∞—Ä—Å–∏–Ω–≥ workflows/*.json).

**–¶–µ–ª—å:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ workflows –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å reference-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π outputs resolver –≤ comfy/client.py –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–¢–∏–∫–µ—Ç:** T-003

**–ò–∑–º–µ–Ω–µ–Ω–æ/–¥–æ–±–∞–≤–ª–µ–Ω–æ:**
- docs/WORKFLOWS_REFERENCE.md (—Å–æ–∑–¥–∞–Ω, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ workflows)
- docs/CHANGELOG_INTERNAL.md (—ç—Ç–∞ –∑–∞–ø–∏—Å—å)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤ –∫–∞–∂–¥–æ–≥–æ workflow –±—É–¥–µ—Ç –¥–æ–ø–∏—Å–∞–Ω–æ –≤ WORKFLOWS_REFERENCE.md –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ JSON.

---

# CHANGELOG_INTERNAL (img_bot)

–†‚Äì–°—ì–°–Ç–†–Ö–†¬∞–†¬ª –†‚Äô–†–é–†‚Ä¢–†“ê –†–Ü–†–Ö–°—ì–°‚Äö–°–Ç–†¬µ–†–Ö–†–Ö–†—ë–°‚Ä¶ –†—ë–†¬∑–†—ò–†¬µ–†–Ö–†¬µ–†–Ö–†—ë–†‚Ññ –†—ó–°–Ç–†—ï–†¬µ–†—î–°‚Äö–†¬∞. –†‚Äô–°–É–†¬µ –†¬∑–†¬∞–†—ó–†—ë–°–É–†—ë –†–Ö–†¬∞ –°–Ç–°—ì–°–É–°–É–†—î–†—ï–†—ò.

**–†—ü–°–Ç–†¬∞–†–Ü–†—ë–†¬ª–†—ï:** –†—î–†¬∞–†¬∂–†“ë–°‚Äπ–†‚Ññ –†—î–†—ï–†—ò–†—ò–†—ë–°‚Äö –°–É –†—ë–†¬∑–†—ò–†¬µ–†–Ö–†¬µ–†–Ö–†—ë–†¬µ–†—ò –†—î–†—ï–†“ë–†¬∞ –†—õ–†‚Äò–†–á–†‚Äî–†—í–†—ú –°–É–†—ï–†“ë–†¬µ–°–Ç–†¬∂–†¬∞–°‚Äö–°–ä –†¬∑–†¬∞–†—ó–†—ë–°–É–°–ä –†¬∑–†“ë–†¬µ–°–É–°–ä.

---

## 2025-01-17 ‚Äî T-004.1: Smoke-check –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ComfyUI (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API)

**–¶–µ–ª—å:** –ò–º–µ—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∑–¥–æ—Ä–æ–≤—å—è ComfyUI —Å –ø–æ–Ω—è—Ç–Ω—ã–º –¥–∏–∞–≥–Ω–æ–∑–æ–º –∏ exit code.

**–¢–∏–∫–µ—Ç:** T-004.1

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- `tools/smoke_check.py` ‚Äî smoke-check —Å–∫—Ä–∏–ø—Ç:
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `/`, `/system_stats`, `/queue`, `/object_info`
  - –ü–µ—á–∞—Ç–∞–µ—Ç OK/FAIL –ø–æ –∫–∞–∂–¥–æ–º—É endpoint
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç exit code: 0 (OK) / 1 (FAIL)
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏: `--repeat N --delay S`
  - URL –∑–∞–¥–∞—ë—Ç—Å—è `--url` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `COMFY_URL`
  - –ú–∏–Ω–∏-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ: –ø–æ—á–µ–º—É –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```sh
# –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python tools/smoke_check.py

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º URL
python tools/smoke_check.py --url http://localhost:8188

# –° –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ComfyUI)
python tools/smoke_check.py --repeat 5 --delay 1.0

# –° –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
COMFY_URL=http://192.168.1.100:8188 python tools/smoke_check.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ComfyUI API –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞
- –ü–æ–Ω—è—Ç–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (ComfyUI –Ω–µ –∑–∞–ø—É—â–µ–Ω, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL, –≤–µ—Ä—Å–∏—è API –∏ —Ç.–ø.)
- Exit code –¥–ª—è CI/—Å–∫—Ä–∏–ø—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

---

## 2025-01-17 ‚Äî T-003.3: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä WORKFLOWS_REFERENCE (–±–µ–∑ timestamp)

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å timestamp –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å "–ø—É—Å—Ç—ã—Ö" –∫–æ–º–º–∏—Ç–æ–≤ –∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∞ –≤ CI.

**–¢–∏–∫–µ—Ç:** T-003.3

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**

- `tools/gen_workflows_reference.py` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  - –£–±—Ä–∞–Ω timestamp –∏–∑ —à–∞–ø–∫–∏ —Ñ–∞–π–ª–∞ (–±—ã–ª–∞ —Å—Ç—Ä–æ–∫–∞ —Å –¥–∞—Ç–æ–π/–≤—Ä–µ–º–µ–Ω–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
  - –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_normalize_nodes()` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ dict, —Ç–∞–∫ –∏ list —Ñ–æ—Ä–º–∞—Ç–∞ nodes
  - –£–ª—É—á—à–µ–Ω–∞ `_guess_kind()` ‚Äî –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ (image/video/unknown)
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ `_md_escape_cell()` ‚Äî —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è Markdown —Ç–∞–±–ª–∏—Ü
  - –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ workflows –ø–æ –∏–º–µ–Ω–∏ (sorted)
  - –°—Ç–∞–±–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π JSON ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π WORKFLOWS_REFERENCE.md

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ–ø–µ—Ä—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π: –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö workflows/*.json –≤—ã–¥–∞—ë—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π WORKFLOWS_REFERENCE.md
- CI `.github/workflows/docs-workflows-reference.yml` –Ω–µ –±—É–¥–µ—Ç –ª–æ–≤–∏—Ç—å –ª–æ–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ö–æ–º–º–∏—Ç—ã —Å—Ç–∞–Ω—É—Ç —á–∏—â–µ (–Ω–µ –±—É–¥–µ—Ç diff –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É —Å timestamp)

---

## 2025-01-17 ‚Äî T-004.2: Smoke-check –Ω–∞ urllib (–±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç requests)

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `requests`, —á—Ç–æ–±—ã smoke-check —Ä–∞–±–æ—Ç–∞–ª –≤ —á–∏—Å—Ç–æ–º venv –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤.

**–¢–∏–∫–µ—Ç:** T-004.2

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- `tools/smoke_check.py` ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
  - –ó–∞–º–µ–Ω—ë–Ω `requests` –Ω–∞ `urllib.request` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python)
  - –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: `CheckResult` dataclass —Å `ok`, `status`, `elapsed_ms`, `error`, `data`
  - –§—É–Ω–∫—Ü–∏—è `_http_json()` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π GET —Å —Ç–∞–π–º–∞—É—Ç–æ–º –∏ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON
  - –§—É–Ω–∫—Ü–∏—è `_print_endpoint()` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (‚úÖ OK / ‚ùå FAIL)
  - –§—É–Ω–∫—Ü–∏—è `_summarize()` ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –æ—Ç–≤–µ—Ç—É (–∫–ª—é—á–∏ JSON, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ queue, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥)
  - –£–±—Ä–∞–Ω –∫–æ—Ä–Ω–µ–≤–æ–π endpoint `/` (–Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API)
  - –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è: `/system_stats`, `/queue`, `/object_info`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Smoke-check —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —á–∏—Å—Ç–æ–º Python venv –±–µ–∑ `pip install requests`
- –ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –µ—Å—Ç—å)
- –õ—É—á—à–∏–π –≤—ã–≤–æ–¥: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç HTTP status, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (ms), –æ—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- Exit codes: 0 (OK), 1 (FAIL), 2 (invalid args)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```sh
# –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python tools/smoke_check.py

# –° –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ComfyUI)
python tools/smoke_check.py --repeat 5 --delay 1.0

# –ö–∞—Å—Ç–æ–º–Ω—ã–π URL –∏ timeout
python tools/smoke_check.py --url http://192.168.1.100:8188 --timeout 5.0
```

---

## 2025-01-17 ‚Äî T-004.3: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è line endings —á–µ—Ä–µ–∑ .gitattributes

**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è Git "LF will be replaced by CRLF" –∏ –∏–∑–±–µ–∂–∞—Ç—å –ø—É—Å—Ç—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤ –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ –æ–∫–æ–Ω—á–∞–Ω–∏—è—Ö —Å—Ç—Ä–æ–∫.

**–¢–∏–∫–µ—Ç:** T-004.3

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- `.gitattributes` ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ –¥–ª—è Python –ø—Ä–æ–µ–∫—Ç–∞ (–≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ .NET —à–∞–±–ª–æ–Ω–∞)
  - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `* text=auto eol=lf` ‚Äî –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ —Å LF
  - Windows scripts (*.bat, *.cmd, *.ps1) ‚Äî eol=crlf (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è Windows)
  - –ö–æ–¥ –∏ –∫–æ–Ω—Ñ–∏–≥–∏ (*.py, *.yml, *.json, *.md) ‚Äî eol=lf (Unix —Å—Ç–∏–ª—å)
  - Shell scripts –∏ hooks (.githooks/*, *.sh) ‚Äî eol=lf (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `binary`: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ, –º–æ–¥–µ–ª–∏ ML (*.safetensors, *.pt, *.ckpt)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Git –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ–± –∞–≤—Ç–æ–∑–∞–º–µ–Ω–µ LF‚ÜîCRLF –ø—Ä–∏ –∫–æ–º–º–∏—Ç–∞—Ö –Ω–∞ Windows
- CI/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç "–ø—É—Å—Ç—ã–µ" –∫–æ–º–º–∏—Ç—ã –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ line endings
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π git diff
- Pre-commit hooks (–≤ .githooks/) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö

---

## 2025-01-17 ‚Äî T-005: –°–∫–≤–æ–∑–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω Telegram ‚Üí ComfyUI ‚Üí output ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram —Å –æ—á–µ—Ä–µ–¥—å—é, –≤–æ—Ä–∫–µ—Ä–∞–º–∏, —Ç–∞–π–º–∞—É—Ç–∞–º–∏, retry-–ª–æ–≥–∏–∫–æ–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–¢–∏–∫–µ—Ç:** T-005

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- `core/job_queue.py` ‚Äî –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å –≤–æ—Ä–∫–µ—Ä–∞–º–∏
  - –ö–ª–∞—Å—Å `Job` ‚Äî –∑–∞–¥–∞—á–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (kind, chat_id, user_id, payload, timeouts, retries)
  - –ö–ª–∞—Å—Å `JobQueue` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Å N –≤–æ—Ä–∫–µ—Ä–∞–º–∏
  - `JobStatus` enum: queued, running, retrying, done, failed, canceled
  - Retry-–ª–æ–≥–∏–∫–∞: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff —Å –¥–∂–∏—Ç—Ç–µ—Ä–æ–º
  - Timeout –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ (asyncio.timeout)
  - Cancel support: graceful –æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ Event
  - Callbacks: on_status, on_done, on_error –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å UI

- `core/telegram_pipeline.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram + ComfyUI
  - –ö–ª–∞—Å—Å `TelegramComfyPipeline` ‚Äî –≥–ª–∞–≤–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω
  - `enqueue_from_message()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ job –∏–∑ Telegram —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å-—Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é (video/gif/image/file)
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ Telegram: send_video/send_animation/send_photo/send_document
  - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π worker –¥–ª—è comfy/client.py (–ø—Ä–æ–±—É–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–µ—Ç–æ–¥–æ–≤)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ Telegram rate limits (TelegramRetryAfter)
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: PIPELINE_CONCURRENCY, PIPELINE_TIMEOUT_IMAGE_S, PIPELINE_TIMEOUT_VIDEO_S

- `bot/handlers/t005_pipeline_demo.py` ‚Äî –¥–µ–º–æ handler
  - `/gen <prompt>` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ pipeline
  - `/video <prompt>` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ pipeline
  - `/cancel` ‚Äî –æ—Ç–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º concurrency (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2 –≤–æ—Ä–∫–µ—Ä–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö/–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2 –ø–æ–≤—Ç–æ—Ä–∞)
- Timeouts: 600s –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, 1800s –¥–ª—è –≤–∏–¥–µ–æ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è)
- Graceful shutdown –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å comfy/client.py (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã)
- Telegram rate limit handling (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø–æ—Å–ª–µ sleep)
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å—Ç–∞—Ç—É—Å-—Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

1. –î–æ–±–∞–≤–∏—Ç—å –≤ main.py:
```python
from core.telegram_pipeline import TelegramComfyPipeline, PipelineConfig
from bot.handlers.t005_pipeline_demo import router as t005_demo_router

pipeline = TelegramComfyPipeline(bot, PipelineConfig())
bot["pipeline"] = pipeline

dp.startup.register(lambda: pipeline.start())
dp.shutdown.register(lambda: pipeline.stop())

dp.include_router(t005_demo_router)
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:
```sh
python main.py
```

3. –í Telegram:
- `/gen beautiful sunset over mountains` ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `/video dancing cat` ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
- `/cancel` ‚Üí –æ—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ comfy/client.py:**

–û–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
- –§—É–Ω–∫—Ü–∏—è `run_job(kind, payload) -> path/dict`
- –ö–ª–∞—Å—Å `ComfyClient` —Å –º–µ—Ç–æ–¥–æ–º `run(kind, payload)`, `execute(...)`, `generate(...)`, `generate_image(...)` –∏–ª–∏ `generate_video(...)`

Pipeline –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ –≤—ã–∑–æ–≤–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π.

---

## 2025-01-17 ‚Äî T-005.1: Fix ComfyUIClient.download_file (—É–±—Ä–∞–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ self.log –∏ _download_file_once)

**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ –≤ `comfy/client.py` –≥–¥–µ –º–µ—Ç–æ–¥ `download_file()` —Å—Å—ã–ª–∞–ª—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `self.log` –∏ `_download_file_once()`.

**–¢–∏–∫–µ—Ç:** T-005.1

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- `comfy/client.py` ‚Äî –º–µ—Ç–æ–¥ `download_file()`
  - –¢–µ–ø–µ—Ä—å —è–≤–ª—è–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π –æ–±—ë—Ä—Ç–∫–æ–π –Ω–∞–¥ `view_bytes()`
  - –£–±—Ä–∞–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ `self.log` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π `log`)
  - –£–±—Ä–∞–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ `_download_file_once()`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ docstring —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –º–µ—Ç–æ–¥–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `download_file()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ alias –¥–ª—è `view_bytes()`
- –ù–µ—Ç AttributeError –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `download_file()`
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞





