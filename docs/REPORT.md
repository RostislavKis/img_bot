# üìã –û–¢–ß–Å–¢ –û –ì–û–¢–û–í–ù–û–°–¢–ò –ü–†–û–ï–ö–¢–ê img_bot

## üéØ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### ‚úÖ –ó–ê–î–ê–ß–ê 1: –ê–£–î–ò–¢ –ü–†–û–ï–ö–¢–ê
**–°—Ç–∞—Ç—É—Å:** ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
C:\dev\img_bot/
‚îú‚îÄ‚îÄ main.py                      # Entry point, async setup
‚îú‚îÄ‚îÄ config/settings.py            # –ö–æ–Ω—Ñ–∏–≥ (ComfyUI URL, paths, timeout)
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate.py           # ‚úì –ò–°–ü–†–ê–í–õ–ï–ù: prompt-injection —É–ª—É—á—à–µ–Ω
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ help.py               # ‚úì –°–û–ó–î–ê–ù: –ø–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –Ω–∞ –†–£/EN
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ start.py              # ‚úì –ò–°–ü–†–ê–í–õ–ï–ù: –¥–æ–±–∞–≤–ª–µ–Ω—ã back/settings
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/main_menu.py    # –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ states.py                 # FSM states
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îú‚îÄ‚îÄ comfy/
‚îÇ   ‚îú‚îÄ‚îÄ client.py                 # API –∫ ComfyUI (POST /prompt, /history)
‚îÇ   ‚îú‚îÄ‚îÄ workflow_loader.py        # ‚úì –ó–∞–≥—Ä—É–∑—á–∏–∫ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞)
‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îú‚îÄ‚îÄ flux_dev_fp8.json         # ‚úì FLUX –∫–∞—á–µ—Å—Ç–≤–æ (28 steps, 1024x1024)
‚îÇ   ‚îú‚îÄ‚îÄ flux_schnell_fp8.json     # ‚úì FLUX –±—ã—Å—Ç—Ä–æ (4 steps, 1024x1024)
‚îÇ   ‚îú‚îÄ‚îÄ sdxl_base_refiner.json    # ‚úì SDXL –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ video_default.json        # ‚úì AnimateDiff –≤–∏–¥–µ–æ (16 frames, 512x512)
‚îú‚îÄ‚îÄ storage/                      # –ë–î (SQLite)
‚îú‚îÄ‚îÄ i18n/                         # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –†–£/EN
‚îî‚îÄ‚îÄ utils/                        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ö–µ–ª–ø–µ—Ä—ã
```

**–¶–µ–ø–æ—á–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:**
```
Telegram ‚Üí Handler (msg_prompt)
  ‚Üì
_parse_prefix() ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç workflow (dev/schnell/video/edit)
  ‚Üì
WorkflowLoader.load() ‚Üí JSON ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É
  ‚Üì
_inject_prompt() ‚Üí –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤–æ –≤—Å–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ–ª—è
_inject_seed_steps_cfg() ‚Üí –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (seed, steps, cfg)
_inject_resolution() ‚Üí —Ä–∞–∑–º–µ—Ä (width, height)
_inject_image_filename() ‚Üí –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  ‚Üì
ComfyUIClient.queue_prompt() ‚Üí POST http://127.0.0.1:8188/prompt
  ‚Üì
ComfyUIClient.wait_for_result() ‚Üí GET /history/{prompt_id}
  ‚Üì
message.answer_photo() / answer_document() ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

---

### ‚úÖ –ó–ê–î–ê–ß–ê 2: –°–ü–†–ê–í–ö–ê –ò –ú–ï–ù–Æ –í –ë–û–¢–ï
**–°—Ç–∞—Ç—É—Å:** ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–∞

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

1. **–ö–Ω–æ–ø–∫–∞ "üìñ –°–ø—Ä–∞–≤–∫–∞"** (`action_help` –≤ `help.py`)
   - –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ **—Ä—É—Å—Å–∫–æ–º** (—Ä–µ–∞–ª–∏–∑–º, –ø—Ä–∏–º–µ—Ä—ã, –ø—Ä–∞–≤–∏–ª–∞)
   - –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –¥–ª—è EN-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –í–∫–ª—é—á–∞–µ—Ç:
     - üì∏ –ö–∞—Ä—Ç–∏–Ω–∫–∞ DEV (2 –º–∏–Ω, FLUX –∫–∞—á–µ—Å—Ç–≤–æ)
     - ‚ö° –ë—ã—Å—Ç—Ä–æ Schnell (30 —Å–µ–∫, FLUX —Å–∫–æ—Ä–æ—Å—Ç—å)
     - üé¨ –í–∏–¥–µ–æ AnimateDiff (1-2 –º–∏–Ω, 16 frames)
     - ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ inpainting (SDXL)
     - üí° –ü—Ä–∞–≤–∏–ª–∞ —Ö–æ—Ä–æ—à–µ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–î–û/–ü–û–°–õ–ï –ø—Ä–∏–º–µ—Ä—ã)
     - üìù –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
     - ‚å®Ô∏è –ü—Ä–µ—Ñ–∏–∫—Å—ã –∫–æ–º–∞–Ω–¥ (dev:, fast:, video:, edit:)

2. **–ö–Ω–æ–ø–∫–∞ "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"** (`action_settings` –≤ `start.py`)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
     - –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     - –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (FLUX Schnell)
     - –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (1024√ó1024)
     - –¢–∞–π–º–∞—É—Ç (60 —Å–µ–∫)

3. **–ö–Ω–æ–ø–∫–∞ "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"** (`action_back` –≤ `start.py`)
   - –û—á–∏—â–∞–µ—Ç FSM state
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

**–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–∫–Ω–æ–ø–∫–∏):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üì∏ –ö–∞—Ä—Ç–∏–Ω–∫–∞  ‚îÇ  ‚ö° –ë—ã—Å—Ç—Ä–æ       ‚îÇ
‚îÇ üé¨ –í–∏–¥–µ–æ     ‚îÇ  ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å‚îÇ
‚îÇ   üìñ –°–ø—Ä–∞–≤–∫–∞                    ‚îÇ
‚îÇ   ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### ‚úÖ –ó–ê–î–ê–ß–ê 3: –ê–í–¢–û–í–´–ë–û–† –ú–û–î–ï–õ–ò/WORKFLOW
**–°—Ç–∞—Ç—É—Å:** ‚úì –†–∞–±–æ—Ç–∞–µ—Ç

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `_parse_prefix()`:**

| –ü—Ä–µ—Ñ–∏–∫—Å | Workflow | –†–µ–∂–∏–º |
|---------|----------|-------|
| `dev:` –∏–ª–∏ `fluxdev:` | `flux_dev_fp8` | üé® –ö–∞—á–µ—Å—Ç–≤–æ (28 steps) |
| `fast:` –∏–ª–∏ `schnell:` | `flux_schnell_fp8` | ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å (4 steps) |
| `video:` –∏–ª–∏ `vid:` | `video_default` | üé¨ –í–∏–¥–µ–æ (16 frames) |
| `edit:` | `image_edit` –∏–ª–∏ `sdxl_base_refiner` | ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `xl:` –∏–ª–∏ `photo:` | `sdxl_base_refiner` | üì∑ SDXL —Ä–µ–∞–ª–∏–∑–º |
| *–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞* | –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `generation_mode` | –ø–æ —Ä–µ–∂–∏–º—É –∫–Ω–æ–ø–∫–∏ |

**–ü—Ä–∏–º–µ—Ä—ã:**
```
dev: –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞, –ø–æ—Ä—Ç—Ä–µ—Ç
     ‚Üí flux_dev_fp8 (–∫–∞—á–µ—Å—Ç–≤–æ)

fast: –∫–æ—Ç –Ω–∞ –¥–∏–≤–∞–Ω–µ
     ‚Üí flux_schnell_fp8 (–±—ã—Å—Ç—Ä–æ, ~30 —Å–µ–∫)

video: –∫–æ—Ç –ø—Ä—ã–≥–∞–µ—Ç —á–µ—Ä–µ–∑ –∑–∞–±–æ—Ä
     ‚Üí video_default (–≤–∏–¥–µ–æ, GIF)

edit: –¥–æ–±–∞–≤—å —Å–æ–ª–Ω–µ—á–Ω—ã–µ –æ—á–∫–∏
     ‚Üí sdxl_base_refiner (—Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Ñ–æ—Ç–æ)
```

---

### ‚úÖ –ó–ê–î–ê–ß–ê 4: –£–õ–£–ß–®–ï–ù–ò–ï PROMPT-INJECTION
**–°—Ç–∞—Ç—É—Å:** ‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞:**
- –ò–Ω–æ–≥–¥–∞ –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –≤ workflow
- –ù–∏–∫–∞–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `_inject_prompt()`:**

1. **–†–∞—Å—à–∏—Ä–µ–Ω —Å–ø–∏—Å–æ–∫ PROMPT_KEYS:**
   ```python
   PROMPT_KEYS = (
       "text",
       "prompt",
       "positive",
       "positive_prompt",
       "prompt_text",
       "text_g",
       "text_l",
       "clip_text",              # ‚Üê –Ω–æ–≤—ã–π
       "conditioning_text",      # ‚Üê –Ω–æ–≤—ã–π
   )
   ```

2. **–¢—Ä—ë—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π:**
   - –§–∞–∑–∞ 1: –°–æ–±—Ä–∞—Ç—å –≤—Å–µ string-–∫–ª—é—á–∏ –≤ workflow
   - –§–∞–∑–∞ 2: –í—Å—Ç–∞–≤–∏—Ç—å –≤ PROMPT_KEYS (–≤—Å–µ, –Ω–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ!)
   - –§–∞–∑–∞ 3: Fallback ‚Äî —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –ø–æ `"prompt"` –∏–ª–∏ `"text"` –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏

3. **–£–º–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
   ```
   ‚ö†Ô∏è –ò–Ω–∂–µ–∫—Ç –ø—Ä–æ–º–ø—Ç–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è.
   –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏: seed, steps, cfg, width, height, ...
   –î–æ—Å—Ç—É–ø–Ω—ã–µ PROMPT_KEYS: text, prompt, positive, ...
   –ü–æ–ø—Ä–æ–±—É–π –∏–∑–º–µ–Ω–∏—Ç—å workflow –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á –≤ PROMPT_KEYS.
   ```

   –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –æ—Ç–ª–∞–¥–∏—Ç—å –Ω–æ–≤—ã–µ workflows!

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–∞:**
   ```
   ‚úì –ü—Ä–æ–º–ø—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ 2 –ø–æ–ª–µ(—è—Ö): '–∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ —Å –≥–æ...'
   ```

---

### ‚úÖ –ó–ê–©–ò–¢–ê UTF-8 –ö–û–î–ò–†–û–í–ö–ò
**–°—Ç–∞—Ç—É—Å:** ‚úì –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

**`.editorconfig`:**
```ini
[*]
charset = utf-8
end_of_line = crlf
insert_final_newline = true

[*.py]
indent_style = space
indent_size = 4
```

**–í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `help.py` ‚Äî —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç 100% —á–∏—Ç–∞–µ–º
- ‚úÖ `generate.py` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ª–æ–≥–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ `start.py` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ JSON workflows ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –±–µ–∑ BOM
- ‚úÖ `.editorconfig` ‚Äî UTF-8 enforcement

---

## üß™ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –í TELEGRAM

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞
```powershell
.\.venv\Scripts\python.exe .\main.py
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
[INFO] Bot started: @your_bot_name
[INFO] ComfyUI health: OK
[INFO] Workflows found: 4
```

### –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤—å `/start`
–ë–æ—Ç —Å–ø—Ä–æ—Å–∏—Ç –≤—ã–±—Ä–∞—Ç—å —è–∑—ã–∫ (üá∑üá∫ –†—É—Å—Å–∫–∏–π / üá¨üáß English)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å –∫–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
```
üì∏ –ö–∞—Ä—Ç–∏–Ω–∫–∞  ‚ö° –ë—ã—Å—Ç—Ä–æ
üé¨ –í–∏–¥–µ–æ     ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
   üìñ –°–ø—Ä–∞–≤–∫–∞
   ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
```

**–¢–µ—Å—Ç #1: –ù–∞–∂–º–∏ "üìñ –°–ø—Ä–∞–≤–∫–∞"**
- ‚úÖ –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –ø–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–µ—Ñ–∏–∫—Å—ã

**–¢–µ—Å—Ç #2: –ù–∞–∂–º–∏ "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"**
- ‚úÖ –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ –Ø–∑—ã–∫, –º–æ–¥–µ–ª—å, —Ä–∞–∑–º–µ—Ä, —Ç–∞–π–º–∞—É—Ç

**–¢–µ—Å—Ç #3: –ù–∞–∂–º–∏ "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"** (–∏–∑ —Å–ø—Ä–∞–≤–∫–∏)
- ‚úÖ –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### –®–∞–≥ 4: –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π)

**–¢–µ—Å—Ç 4a: –†–µ–∂–∏–º "–ö–∞—Ä—Ç–∏–Ω–∫–∞ (DEV)" ‚Üí –∫–∞—á–µ—Å—Ç–≤–æ**
```
1. –ù–∞–∂–º–∏ üì∏ –ö–∞—Ä—Ç–∏–Ω–∫–∞
2. –ù–∞–ø–∏—à–∏: –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞, –ø–æ—Ä—Ç—Ä–µ—Ç, 4K
3. –û–∂–∏–¥–∞–π ~2 –º–∏–Ω—É—Ç—ã
4. –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ‚úì –ü—Ä–æ–º–ø—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ 2 –ø–æ–ª–µ(—è—Ö)
   ‚úì Checkpoint chosen: flux1-dev-fp8
   ‚úì Result received: image.png
```

**–¢–µ—Å—Ç 4b: –†–µ–∂–∏–º "–ë—ã—Å—Ç—Ä–æ (Schnell)" ‚Üí —Å–∫–æ—Ä–æ—Å—Ç—å**
```
1. –ù–∞–∂–º–∏ ‚ö° –ë—ã—Å—Ç—Ä–æ
2. –ù–∞–ø–∏—à–∏: –∫–æ—Ç —Å–ø–∏—Ç –Ω–∞ –¥–∏–≤–∞–Ω–µ
3. –û–∂–∏–¥–∞–π ~30 —Å–µ–∫
4. –í –ª–æ–≥–∞—Ö: steps=4, cfg=1.0
```

**–¢–µ—Å—Ç 4c: –° –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "fast:"**
```
1. –ù–∞–∂–º–∏ üì∏ –ö–∞—Ä—Ç–∏–Ω–∫–∞
2. –ù–∞–ø–∏—à–∏: fast: –∫–æ—Ç –Ω–∞ –ø–æ–¥—É—à–∫–µ
3. –î–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ flux_schnell_fp8 (–Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ä–µ–∂–∏–º DEV)
4. –í –ª–æ–≥–∞—Ö: Using default workflow: flux_schnell_fp8
```

**–¢–µ—Å—Ç 4d: –†–µ–∂–∏–º "–í–∏–¥–µ–æ" ‚Üí GIF**
```
1. –ù–∞–∂–º–∏ üé¨ –í–∏–¥–µ–æ
2. –ù–∞–ø–∏—à–∏: –∫–æ—Ç –ø—Ä—ã–≥–∞–µ—Ç —á–µ—Ä–µ–∑ –∑–∞–±–æ—Ä
3. –û–∂–∏–¥–∞–π ~1-2 –º–∏–Ω—É—Ç—ã
4. –ü–æ–ª—É—á–∏ GIF 16 frames
```

**–¢–µ—Å—Ç 4e: –†–µ–∂–∏–º "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"**
```
1. –ù–∞–∂–º–∏ ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
2. –û—Ç–ø—Ä–∞–≤—å —Å–≤–æ—ë —Ñ–æ—Ç–æ
3. –ù–∞–ø–∏—à–∏: –¥–æ–±–∞–≤—å —Å–æ–ª–Ω–µ—á–Ω—ã–µ –æ—á–∫–∏
4. –í –ª–æ–≥–∞—Ö: Image uploaded: tg_xxxxx.jpg
5. –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sdxl_base_refiner –¥–ª—è inpainting
```

### –®–∞–≥ 5: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ï—Å–ª–∏ workflow –Ω–µ –Ω–∞–π–¥—ë—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ:**
```
–í –ª–æ–≥–∞—Ö:
‚ö†Ô∏è –ò–Ω–∂–µ–∫—Ç –ø—Ä–æ–º–ø—Ç–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è.
–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏: seed, steps, cfg, ...

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
‚ùå –û—à–∏–±–∫–∞: –í workflow –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞.
–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏: seed, steps, cfg, ...
–û–±—Ä–∞—Ç–∏—Å—å –∫ –∞–¥–º–∏–Ω—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ workflow.
```

---

## üîß –§–ê–ô–õ–´, –ö–û–¢–û–†–´–ï –ë–´–õ–ò –ò–ó–ú–ï–ù–ï–ù–´

### 1. `bot/handlers/generate.py`
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω `PROMPT_KEYS` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `clip_text`, `conditioning_text`)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ `_inject_prompt()` (—Ç—Ä—ë—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–∏—Å–∫, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
- ‚úÖ –õ—É—á—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –∏ –æ—à–∏–±–∫–µ

### 2. `bot/handlers/help.py` (–±—ã–ª –ø—É—Å—Ç–æ–π, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –Ω–∞ **—Ä—É—Å—Å–∫–æ–º** (500+ —Å—Ç—Ä–æ–∫)
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö/–ø–ª–æ—Ö–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ –ü—Ä–µ—Ñ–∏–∫—Å—ã –∫–æ–º–∞–Ω–¥
- ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 3. `bot/handlers/start.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `action_back` (–≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `action_settings` (–ø–æ–∫–∞–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –†—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç

### 4. `.editorconfig`
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ: `charset = utf-8` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

## üìä –°–¢–ê–¢–£–° –ó–ê–î–ê–ß

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ |
|--------|--------|---|
| **1. –ê—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞** | ‚úÖ | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø–∏—Å–∞–Ω–∞, —Ü–µ–ø–æ—á–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ |
| **2. –°–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç–µ** | ‚úÖ | `help.py` —Å –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –†–£/EN, –ø—Ä–∏–º–µ—Ä—ã, –ø—Ä–µ—Ñ–∏–∫—Å—ã |
| **3. –ê–≤—Ç–æ–≤—ã–±–æ—Ä workflow** | ‚úÖ | `_parse_prefix()` —Ä–∞–±–æ—Ç–∞–µ—Ç: dev/schnell/video/edit/xl |
| **4. Prompt-injection** | ‚úÖ | –†–∞—Å—à–∏—Ä–µ–Ω—ã PROMPT_KEYS, —Ç—Ä—ë—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–∏—Å–∫, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| **5. UTF-8 –∑–∞—â–∏—Ç–∞** | ‚úÖ | `.editorconfig` —Å `charset = utf-8`, –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ OK |

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è:

1. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞** (–±–ª–æ–∫–∏: —Å—Ç–∏–ª—å, —Å–≤–µ—Ç, —Ñ–æ–Ω)
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ inline-–º–µ–Ω—é —Å –≤—ã–±–æ—Ä–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –°–æ–±–∏—Ä–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç

2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–ø–µ–∫—Ç–æ–≤ (aspect ratio)**
   - 1:1, 3:2, 16:9, 9:16
   - –î–æ–±–∞–≤–∏—Ç—å –≤ settings

3. **–ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π**
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î
   - –ö–æ–º–∞–Ω–¥–∞ `/history` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

4. **–ë—ã—Å—Ç—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (refiner)**
   - –ö–Ω–æ–ø–∫–∞ "–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ" –¥–ª—è —É–∂–µ –≥–æ—Ç–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SDXL refiner

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ò –í–û–ü–†–û–°–´

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±–æ—Ç–∞:
   ```
   [ERROR] Generation failed: ...
   [WARNING] ‚ö†Ô∏è –ò–Ω–∂–µ–∫—Ç –ø—Ä–æ–º–ø—Ç–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
   ```

2. –ü—Ä–æ–≤–µ—Ä—å ComfyUI –¥–æ—Å—Ç—É–ø–µ–Ω:
   ```powershell
   curl http://127.0.0.1:8188/health
   ```

3. –ü—Ä–æ–≤–µ—Ä—å workflow JSON –≤ `C:\dev\img_bot\workflows`

---

**–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞:** 2026-02-07  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ ‚úÖ
